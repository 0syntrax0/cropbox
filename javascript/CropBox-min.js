var cropbox=function(e){var t=document.querySelector(e.imageBox),n={state:{},ratio:1,options:e,imageBox:t,thumbBox:t.querySelector(e.thumbBox),spinner:t.querySelector(e.spinner),image:new Image,getAvatar:function(){var e=this.thumbBox.clientWidth,n=this.thumbBox.clientHeight,i=document.createElement("canvas"),a=t.style.backgroundPosition.split(" "),o=t.style.backgroundSize.split(" "),s=parseInt(a[0])-t.clientWidth/2+e/2,r=parseInt(a[1])-t.clientHeight/2+n/2,c=parseInt(o[0]);dh=parseInt(o[1]),sh=parseInt(this.image.height),sw=parseInt(this.image.width),i.width=e,i.height=n;var u=i.getContext("2d");u.drawImage(this.image,0,0,sw,sh,s,r,c,dh);var d=i.toDataURL("image/jpeg");return d},zoomIn:function(){this.ratio*=1.1,i()},zoomOut:function(){this.ratio*=.9,i()}},i=function(){var e=parseInt(n.image.width)*n.ratio,i=parseInt(n.image.height)*n.ratio,a=(t.clientWidth-e)/2,o=(t.clientHeight-i)/2;t.setAttribute("style","background-image: url("+n.image.src+"); background-size: "+e+"px "+i+"px; background-position: "+a+"px "+o+"px; background-repeat: no-repeat")},a=function(e){e.stopImmediatePropagation(),n.state.dragable=!0,n.state.mouseX=e.clientX,n.state.mouseY=e.clientY},o=function(e){if(e.stopImmediatePropagation(),n.state.dragable){var i=e.clientX-n.state.mouseX,a=e.clientY-n.state.mouseY,o=t.style.backgroundPosition.split(" "),s=i+parseInt(o[0]),r=a+parseInt(o[1]);t.style.backgroundPosition=s+"px "+r+"px",n.state.mouseX=e.clientX,n.state.mouseY=e.clientY}},s=function(e){e.stopImmediatePropagation(),n.state.dragable=!1},r=function(e){var t=window.event||e,a=t.detail?-120*t.detail:t.wheelDelta;n.ratio*=a>-120?1.1:.9,i()},c=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n)},u=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener&&e.removeEventListener(t,render)};return n.spinner.style.display="block",n.image.onload=function(){n.spinner.style.display="none",i(),c(t,"mousedown",a),c(t,"mousemove",o),c(window,"mouseup",s);var e=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";c(t,e,r)},n.image.src=e.imgSrc,c(t,"DOMNodeRemoved",function(){u(window,"DOMNodeRemoved",s)}),n};